# Object Access

The endpoints in this section perform actions on objects stored by the server. 

Each endpoint in this section requires a Tunneled request and with an `Authorization` header set according to [protocol](protocol.md#tunneling).

## Vault Access

### List Vaults

Endpoint: `/users/{userid}/vaults`

Method: GET

Mode: Tunneled

URL Fields: `userid` is the UUID of the account to list vaults for

Response: Error or 200 OK 

Response body:
```rust
pub struct ListVaultsResponse{
    vaults: Vec<Vault>
}

pub struct Vault{
    vault_id: Uuid,
    vault_key: Vec<u8>
}
```

Errors:
* 404 Not Found with an code of `ErrorCode::NoSuchObject`: If the user with id `userid` does not exist
* 403 Forbidden with a code of `ErrorCode::AccessViolation`: Optional, if the `userid` has no vaults accesible to the current user.

### List Vault Contents

Endpoint: `/vaults/{vaultid}/objects`

Method: GET

Mode: Tunneled

URL Fields: `vaultid` is the UUID of the vault to access

Response: Error or 200 OK

Response Body:

```rust
pub struct ListContentsResponse{
    vaults: Vec<ObjectRef>
}

pub struct ObjectRef{
    object_id: Uuid,
    object_type: Uuid,
    display_tag: Vec<String>,
}
```

Where `object_id` is the id of the object, `object_type` is the type of the object (see object types below, the client may set the value to whatever it wants when creating the object), and `display_tag` is an array of user-settable strings that the client SHOULD display. 

Errors:
* 404 Not Found with a code of `ErrorCode::NoSuchObject`: If the vault with id `vaultid` does not exist
* 403 Forbidden with a code of `ErrorCOde::AccessViolation`: If the current user does not have access to the chosen vault

### Create Object in Vault

Endpoint: `/vaults/{vaultid}/objects`

Method: POST

Mode: Tunneled

URL Fields: `vaultid` is the UUID of the vault to access

Request Body:

```rust
pub struct CreateObjectRequest{
    object_type: Uuid,
    display_tag: Vec<String>,
}
```

Response: Error or 200 OK

Response Body:

```rust
pub struct CreateObjectResonse{
    object_id: Uuid
}
```

Errors:
* 404 Not Found with a code of `ErrorCode::NoSuchObject`: If the vault with id `vaultid` does not exist
* 403 Forbidden with a code of `ErrorCOde::AccessViolation`: If the current user does not have access to the chosen vault


## Object Types

Object Types are uuids, set by the client. Clients MUST accept objects with unknown types. Clients SHOULD NOT display objects with an unknown type to users or attempt to write to such objects unless the user has used a client-provided mechanism to indicate a particular object type's display. This specification does not define that mechanism. A client MAY support any object type it chooses, and SHOULD support all object types defined herein. 

The following object types are predeined by this specification. If supported by a client, these MUST have the format specified below. Such object types are generated by a version 5 UUID of the name of the type using `66345b9a-63e5-5874-be6f-0d5f6cd449dd` as the namespace:
* `f8ba28a6-f463-557a-beab-2466a5bfbbb7` (Username): Contains a bare UTF-8 string that indicates a username.
* `2a880e92-909d-5d68-bf3a-6e3d0ea4492b` (Password): Contains a bare UTF-8 string that indicates a password. 
* `1e76db93-32c3-5331-aa4f-c8273ba4f893` (Domain): Contains a bare UTF-8 String that indicates a domain pattern. Either a DNS name or an EMCAScript Regex that matches a domain name.
* `a55afe8a-0139-5798-a22f-94f9a5270294` (Group): Contains a json object that contains a `Vec<Uuid>` that refers to several other objects
* `13da722f-f84c-59cc-b197-5109bba46edc` (TextString): Contains a bare UTF-8 string, with no requirements on Form
* `d1d6f16e-6115-5eee-8534-0f9a787fb32c` (TotpGenerator): Contains a json object in the following schema
```rust
pub struct TotpGenerator{
    secret: Vec<u8>,
    digits: u32,
    refresh_period: Duration,
    hash_algorithm: HashType
}
```